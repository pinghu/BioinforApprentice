setwd('E:\\r\\biotrainee_demo\\class 2')
#http://hgdownload.cse.ucsc.edu/goldenPath/hg19/bigZips/chromFa.tar.gz
# ????????????

t1 <- Sys.time()

df <- read.csv('chr1.fa', header=F, stringsAsFactors=F)

# index_df ???chr???????????????

index_df <- data.frame(begin=which(sapply(df[,1], function(x){
  
  substr(x, start=1, stop=1)=='>'})))

# index_df1 ???string???????????????+1

index_df1 <- data.frame(rbind(matrix(index_df[-1,1]),dim(df)[1]+1))

# ???index_start???index_end??????data.frame

index_df2 <- cbind(index_df, index_df1)

remove(index_df1, index_df)

# ???????????????????????????string????????????N???GC?????????

result <- apply(index_df2, 1, function(x) {  # ?????????????????????????????????????????????
  
  y <- toupper(paste(df[(x[1]+1):(x[2]-1),1], collapse=''))
  
  y <- strsplit(y, split=character(0))[[1]]
  
  N <- length(y[y =='N'])/length(y)
  
  GC <- length(y[y =='G' | y == 'C'])/(length(y)-length(y[y =='N']))
  
  c(N,GC)
  
})

# ???????????????N???GC?????????

rownames(result) = c('N','GC')

result <- t(result)

# ??????????????????

head(result)

difftime(Sys.time(), t1, units = 'secs')